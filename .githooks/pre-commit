#!/usr/bin/env bash
set -euo pipefail

# Get staged .go files (excluding deleted files)
staged_go_files=$(git diff --cached --name-only --diff-filter=d -- '*.go') || true

if [[ -z "$staged_go_files" ]]; then
    exit 0
fi

# Apply //go:fix inline directives
go fix ./...

# Format staged Go files
echo "$staged_go_files" | xargs gofmt -w

# Re-stage any files that were modified by gofmt or go fix
echo "$staged_go_files" | xargs git add
